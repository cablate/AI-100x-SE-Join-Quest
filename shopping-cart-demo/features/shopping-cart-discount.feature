Feature: 購物車折扣計算
  """
  業務規則：
  - VIP 會員滿 1000 元送 100 元
  - 一般會員滿 2000 元打 9 折
  - 優惠擇優使用（不疊加）
  - 折扣上限為原價 70%（最多打 7 折）
  - 活動期限：即日起至 6/30
  """

  Scenario: VIP 會員購買剛好 1000 元獲得優惠
    Given 今天是 2024-06-28
    And 客戶是 VIP 會員
    And 購物車有以下商品：
      | 商品名稱 | 單價 | 數量 |
      | 商品A    | 500  | 2   |
    When 計算折扣後金額
    Then 原始總額應為 1000 元
    And 應套用折扣類型為 "VIP滿千送百"
    And 折扣金額應為 100 元
    And 折扣後總額應為 900 元

  Scenario Outline: 一般會員滿兩千打九折
    Given 今天是 2024-06-28
    And 客戶是一般會員
    And 購物車有以下商品：
      | 商品名稱 | 單價   | 數量 |
      | 商品B    | <price> | <qty> |
    When 計算折扣後金額
    Then 原始總額應為 <amount> 元
    And 應套用折扣類型為 <discount_type>
    And 折扣金額應為 <discount> 元
    And 折扣後總額應為 <final> 元

    Examples:
      | price | qty | amount | discount_type       | discount | final | 測試目的 |
      | 2000  | 1   | 2000   | "一般會員滿額九折" | 200      | 1800  | 剛好滿額 |
      | 1000  | 3   | 3000   | "一般會員滿額九折" | 300      | 2700  | 超過門檻 |
      | 1999  | 1   | 1999   | "無優惠"           | 0        | 1999  | 差1元未滿 |
      | 500   | 10  | 5000   | "一般會員滿額九折" | 500      | 4500  | 大額測試 | 